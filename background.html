<!DOCTYPE html>
<html>
<head>
	<script type="text/javascript" src="js/jquery.1.6.2.min.js"></script>
	<script type="text/javascript" src="js/assistant.js"></script>
</head>
<body>
<script type="text/javascript">

var selectedIndex = null;
var selected = {};

// 监听从contentScript传来的添加商品和获取配置的事件
chrome.extension.onRequest.addListener(
	function(request, sender, sendResponse) {
		if (request.nid) {
			selected[request.nid] = request.status ? request : null;
			sendResponse({status: true, code: request.status ? 'Item moved into trashbox' : 'Item moved out of trashbox' });
		} else if (request.options) {
			sendResponse(assistant.getOptions());
		} else {
			sendResponse({});
		}
	}
);

// 右键菜单打开宝贝下架页面
function getClickHandler() {
	return function(info, tab) {
		chrome.tabs.getSelected(null, function (tab) {
			selectedIndex = tab.id;
			chrome.tabs.create({ url: 'trashbox.html', selected: true, index: tab.index+1 });
		});
	};
};

// 下架完毕后重置按钮
function resetCheckBoxes() {
	chrome.tabs.executeScript(selectedIndex, {code: "jQuery('input.injected').attr('checked', false);"});
	selected = {};
	selectedIndex = null;
}

// 注册右键菜单
chrome.contextMenus.create({
	"title" : "Open Offline Assistant",
	"type" : "normal",
	"contexts" : ["all"],
	"onclick" : getClickHandler(),
	"documentUrlPatterns" : [
		"http://s.etao.com/search?*",
		"http://www.etao.com/search?*"
	]
});

</script>
</body>
</html>