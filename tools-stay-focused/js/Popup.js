
var Popup=function(){return{url:null,fullDomain:null,baseDomain:null,init:function(){this.url=bg().StayFocusd.currentURL;this.fullDomain=bg().DomainParser.extractFullDomain(this.url);this.baseDomain=bg().DomainParser.extractBaseDomain(this.url);var displayTimerInterval=setInterval('Popup.updateDisplayTimer()',1000);$('a.close').click(function(){window.close();});$('.base-domain').html(this.baseDomain);$('.full-domain').html(this.fullDomain);this.initOptions();},initOptions:function(){$('#block-entire').click(function(){Popup.addToList(Popup.baseDomain,'black');});$('#show-advanced-options').click(function(){$('#advanced-options').slideToggle('fast');});$('#show-help').click(function(){Popup.showHelp();});$('#show-options').click(function(){Popup.showOptions();});if(this.fullDomain!==this.baseDomain){this.initFullDomainOptions();}
$('#block-custom').click(function(){Popup.addToList($('#custom-url').val(),'black');});$('#allow-custom').click(function(){Popup.addToList($('#custom-url').val(),'white');});if(bg().StayFocusd.getLocal('hideAllowSiteLink')=='true'){$('.allow').hide();}else{$('#allow-entire').show();$('#allow-entire').click(function(){Popup.addToList(Popup.baseDomain,'white');});}},initFullDomainOptions:function(){var onlyAllowHTML='<li class="option"><a href="javascript:void(0);" id="only-allow" class="allow">Only allow pages on <b class="full-domain">'+this.fullDomain+'</b></a></li>'
var onlyBlockHTML='<li class="option"><a href="javascript:void(0);" id="only-block">Only block pages on <b class="full-domain">'+this.fullDomain+'</b></a></li>'
$('#advanced-options .options .option:first').after(onlyAllowHTML);$('#advanced-options .options .option:first').after(onlyBlockHTML);$('#only-block').click(function(){Popup.addToList(Popup.fullDomain,'black');});$('#only-allow').click(function(){Popup.addToList(Popup.fullDomain,'white');});},updateDisplayTimer:function(){var displayTimer='';if(bg().StayFocusd.isActive()===false){displayTimer="inactive";}else if(bg().NuclearOption.isActive()){displayTimer="nuclear";}else{displayTimer=bg().StayFocusd.getDisplayTimer();if(displayTimer=='00:00:00'){$('#display-timer').addClass('expired');}}
$('#display-timer').html(displayTimer);},showHelp:function(){var helpURL=chrome.extension.getURL('help.html');window.open(helpURL);},showOptions:function(hash){if(hash==undefined){hash='';}
var optionsURL=chrome.extension.getURL('options.html#'+hash);window.open(optionsURL);},addToList:function(domain,listType){var success=false;if(domain!==''){if(listType=='black'){success=bg().ListManager.addToBlacklist(domain);}else{success=bg().ListManager.addToWhitelist(domain);}}
if(success===true){$('#status-msg').removeClass('error');$('#status-msg').addClass('success');$('#status-msg').html('SUCCESS!');setTimeout('window.close()',1500);}else{$('#status-msg').removeClass('success');$('#status-msg').addClass('error');$('#status-msg').html('ERROR');setTimeout("$('#status-msg').hide()",2000);}
$('#status-msg').show();}}}();function bg(){return chrome.extension.getBackgroundPage();}